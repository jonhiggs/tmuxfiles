#!/usr/bin/env bash
source "$(dirname "$0")/../lib/bargraph.sh"

function _charge() {
  acpi | awk -F, '/Battery\ 0/ { print int($2) }'
}

function battery_state() {
  acpi | awk '/Battery\ 0/ { sub(",","",$3); print $3 }'
}

charge=$(_charge)
battery_state="$(battery_state)"
if [[ "${battery_state}" == "Charging" ]] || [[ "${battery_state}" == "AC" ]]; then
  color='#[fg=colour172]'
elif [[ "$(battery_state)" == "Charged" ]]; then
  color='#[fg=green]'
elif [[ "$(battery_state)" == "Discharging" ]] && [[ ${charge} -lt 20 ]]; then
  color='#[fg=red]'
else
  color='#[fg=colour015]'
fi

printf "B:%s%s#[fg=colour015]${color}${charge}%%"
